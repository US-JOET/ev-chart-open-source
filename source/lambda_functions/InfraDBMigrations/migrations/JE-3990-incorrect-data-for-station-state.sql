-- Create a temporary state-to-abbreviation mapping table and use that to update the station states that were migrated from V2.
USE evchart_data_v3;
CREATE TABLE temp_mapping_state_abbr (abbr VARCHAR(2) NOT NULL, state VARCHAR(50) PRIMARY KEY);
INSERT INTO temp_mapping_state_abbr VALUES("al","alabama"),("ak","alaska"),("az","arizona"),("ar","arkansas"),("ca","california"),("co","colorado"),("ct","connecticut"),("de","delaware"),("dc","districtOfColumbia"),("fl","florida"),("ga","georgia"),("hi","hawaii"),("id","idaho"),("il","illinois"),("in","indiana"),("ia","iowa"),("ks","kansas"),("ky","kentucky"),("la","louisiana"),("me","maine"),("mt","montana"),("ne","nebraska"),("nv","nevada"),("nh","newHampshire"),("nj","newJersey"),("nm","newMexico"),("ny","newYork"),("nc","northCarolina"),("nd","northDakota"),("oh","ohio"),("ok","oklahoma"),("or","oregon"),("md","maryland"),("ma","massachusetts"),("mi","michigan"),("mn","minnesota"),("ms","mississippi"),("mo","missouri"),("pa","pennsylvania"),("ri","rhodeIsland"),("sc","southCarolina"),("sd","southDakota"),("tn","tennessee"),("tx","texas"),("ut","utah"),("vt","vermont"),("va","virginia"),("wa","washington"),("wv","westVirginia"),("wi","wisconsin"),("wy","wyoming");
UPDATE station_registrations AS V3_SR, (SELECT A.unique_id AS unique_id, B.abbr AS abbr FROM evchart_data.registered_stations_v2 AS A INNER JOIN temp_mapping_state_abbr AS B ON A.state = B.state) AS state_mapping SET V3_SR.state = state_mapping.abbr WHERE V3_SR.station_uuid = state_mapping.unique_id AND V3_SR.dr_id <> "" AND V3_SR.station_id <> "";
DROP TABLE IF EXISTS temp_mapping_state_abbr;
